<!DOCTYPE HTML>
<html lang="de">
	<head>
		<meta charset="utf-8">
		<!-- EDIT TITLE -->
		<title>Roomplan|Saladhouse</title>
		<!-- /EDIT TITLE -->
		<link rel="stylesheet" href="css/layout.css">
		<link rel="stylesheet" href="css/overlay.css">
		<link rel="stylesheet" href="css/style_dark.css">
		<link rel="stylesheet" href="css/visual.css">
		<!-- ADDITIONAL CSS GO BETWEEN -->
		<!-- /ADDITIONAL CSS GO BETWEEN -->
		<script src="js/jquery-3.6.0.min.js"></script>
		<!-- ADDITIONAL SCRIPTS GO BETWEEN -->
		<script src="js/jcanvas.min.js"></script>
		<script>
			var roomdata = {
				"areawidth": 900,
				"areaheight": 700,
				"sections": [
					{
						"name": "Aussenbereich",
						"outline": {
							"x1": 30, "y1": 480,
						},
						"features": [],
						"tables": [
							{
								"x": 45,
								"y": 500,
								"seatsX": 1,
								"seatsY": 0,
								"isAccessible": true,
								"joins": []
							},
							{
								"x": 45,
								"y": 600,
								"seatsX": 1,
								"seatsY": 0,
								"isAccessible": true,
								"joins": []
							},
							{
								"x": 165,
								"y": 500,
								"seatsX": 1,
								"seatsY": 0,
								"isAccessible": true,
								"joins": []
							},
							{
								"x": 165,
								"y": 600,
								"seatsX": 1,
								"seatsY": 0,
								"isAccessible": true,
								"joins": []
							},
							{
								"x": 265,
								"y": 470,
								"seatsX": 0,
								"seatsY": 2,
								"isAccessible": true,
								"joins": []
							},
							{
								"x": 265,
								"y": 600,
								"seatsX": 0,
								"seatsY": 2,
								"isAccessible": true,
								"joins": []
							},
							{
								"x": 365,
								"y": 470,
								"seatsX": 0,
								"seatsY": 2,
								"isAccessible": true,
								"joins": []
							},
							{
								"x": 365,
								"y": 600,
								"seatsX": 0,
								"seatsY": 2,
								"isAccessible": true,
								"joins": []
							},
							{
								"x": 465,
								"y": 500,
								"seatsX": 1,
								"seatsY": 0,
								"isAccessible": true,
								"joins": []
							},
							{
								"x": 465,
								"y": 600,
								"seatsX": 1,
								"seatsY": 0,
								"isAccessible": true,
								"joins": []
							},
							{
								"x": 765,
								"y": 470,
								"seatsX": 0,
								"seatsY": 2,
								"isAccessible": true,
								"joins": []
							},
							{
								"x": 765,
								"y": 600,
								"seatsX": 0,
								"seatsY": 2,
								"isAccessible": true,
								"joins": []
							},
						],
						"tablejoins": [],
					},
					{
						"name": "Innenbereich",
						"outline": {
							"x1": 350, "y1": 30,
							"x2": 870, "y2": 30,
							"x3": 870, "y3": 430,
							"x4": 350, "y4": 430
						},
						"features": [
							{
								"type": "door",
								"x1": 380,
								"y1": 30,
								"x2": 410,
								"y2": 30,
								"isWC": false
							},
							{
								"type": "door",
								"x1": 810,
								"y1": 30,
								"x2": 840,
								"y2": 30,
								"isWC": true
							},
							{
								"type": "door",
								"x1": 595,
								"y1": 430,
								"x2": 625,
								"y2": 430,
								"isWC": false
							},
							{
								"type": "door",
								"x1": 350,
								"y1": 95,
								"x2": 350,
								"y2": 125,
								"isWC": false
							}
						],
						"tables": [
							{
								"x": 350,
								"y": 290,
								"seatsX": 2,
								"seatsY": 0,
								"isAccessible": false,
								"joins": []
							},
							{
								"x": 350,
								"y": 190,
								"seatsX": 2,
								"seatsY": 0,
								"isAccessible": false,
								"joins": []
							},
							{
								"x": 440,
								"y": 290,
								"seatsX": 2,
								"seatsY": 0,
								"isAccessible": true,
								"joins": []
							},
							{
								"x": 440,
								"y": 190,
								"seatsX": 2,
								"seatsY": 0,
								"isAccessible": true,
								"joins": []
							},
							{
								"x": 720,
								"y": 290,
								"seatsX": 2,
								"seatsY": 0,
								"isAccessible": true,
								"joins": []
							},
							{
								"x": 720,
								"y": 190,
								"seatsX": 2,
								"seatsY": 0,
								"isAccessible": true,
								"joins": []
							},
							{
								"x": 810,
								"y": 290,
								"seatsX": 2,
								"seatsY": 0,
								"isAccessible": false,
								"joins": []
							},
							{
								"x": 810,
								"y": 190,
								"seatsX": 2,
								"seatsY": 0,
								"isAccessible": true,
								"joins": []
							},
							{
								"x": 420,
								"y": 400,
								"seatsX": 0,
								"seatsY": 1,
								"isAccessible": false,
								"joins": []
							},
							{
								"x": 510,
								"y": 400,
								"seatsX": 0,
								"seatsY": 1,
								"isAccessible": true,
								"joins": []
							},
							{
								"x": 700,
								"y": 400,
								"seatsX": 0,
								"seatsY": 1,
								"isAccessible": true,
								"joins": []
							},
							{
								"x": 790,
								"y": 400,
								"seatsX": 0,
								"seatsY": 1,
								"isAccessible": false,
								"joins": []
							},
						],
						"tablejoins": [],
					},
					{
						"name": "Wintergarten",
						"outline": {
							"x1": 30, "y1": 30,
							"x2": 350, "y2": 30,
							"x3": 350, "y3": 430,
							"x4": 30, "y4": 430
						},
						"features": [
							{
								"type": "door",
								"x1": 350,
								"y1": 95,
								"x2": 350,
								"y2": 125,
								"isWC": false
							},
							{
								"type": "door",
								"x1": 100,
								"y1": 430,
								"x2": 130,
								"y2": 430,
								"isWC": false
							},
							{
								"type": "window",
								"x1": 50,
								"y1": 30,
								"x2": 330,
								"y2": 30,
							},
							{
								"type": "window",
								"x1": 30,
								"y1": 50,
								"x2": 30,
								"y2": 420,
							}
						],
						"tables": [
							{
								"x": 190,
								"y": 400,
								"seatsX": 0,
								"seatsY": 1,
								"isAccessible": false,
								"joins": []
							},
							{
								"x": 280,
								"y": 400,
								"seatsX": 0,
								"seatsY": 1,
								"isAccessible": false,
								"joins": []
							},
							{
								"x": 60,
								"y": 30,
								"seatsX": 0,
								"seatsY": 1,
								"isAccessible": false,
								"joins": []
							},
							{
								"x": 135,
								"y": 30,
								"seatsX": 0,
								"seatsY": 1,
								"isAccessible": false,
								"joins": []
							},
							{
								"x": 205,
								"y": 30,
								"seatsX": 0,
								"seatsY": 1,
								"isAccessible": false,
								"joins": []
							},
							{
								"x": 280,
								"y": 30,
								"seatsX": 0,
								"seatsY": 1,
								"isAccessible": false,
								"joins": []
							},
							{
								"x": 30,
								"y": 120,
								"seatsX": 1,
								"seatsY": 0,
								"isAccessible": false,
								"joins": []
							},
							{
								"x": 30,
								"y": 225,
								"seatsX": 1,
								"seatsY": 0,
								"isAccessible": false,
								"joins": []
							},
							{
								"x": 30,
								"y": 330,
								"seatsX": 1,
								"seatsY": 0,
								"isAccessible": false,
								"joins": []
							},
							{
								"x": 290,
								"y": 290,
								"seatsX": 2,
								"seatsY": 0,
								"isAccessible": false,
								"joins": []
							},
							{
								"x": 180,
								"y": 190,
								"seatsX": 2,
								"seatsY": 0,
								"isAccessible": true,
								"joins": []
							},
							{
								"x": 180,
								"y": 290,
								"seatsX": 2,
								"seatsY": 0,
								"isAccessible": true,
								"joins": []
							},
							{
								"x": 290,
								"y": 190,
								"seatsX": 2,
								"seatsY": 0,
								"isAccessible": false,
								"joins": []
							}
						],
						"tablejoins": [],
					}
				]
			}
			/* https://www.youtube.com/watch?v=SETnK2ny1R0 */
			class roomplan{
				constructor(canvas, roomdata, interactive=false){
					
					this.canvas = canvas;
					this.roomdata = roomdata;
					this.interactive = interactive;
					
					this.fontFamily = 'Verdana, sans-serif';
					
					this.outlineWidth = 2;
					this.tableBasis = 30;
					this.fontSize = 16;
					
					this.outlineColor = '#fff';
					this.doorColor = '#ff0';
					this.windowColor = '#03f';
					this.tableColor = '#422';
					this.tableColorHover = '#746';
					this.seatColor = '#633';
					this.seatColorHover = '#959';
					
					this.clickCallback = undefined;
					
					canvas.attr(
						"width", roomdata.areawidth
					).attr(
						"height", roomdata.areaheight
					);
					
					roomdata.sections.forEach(function(val, si, sa){
						if(val.outline.x2){
							//only if there are atleast two points for the outline
							this.canvas.drawLine({
								layer: true,
								name: 'o'+si,
								groups: ['o', 's'+si],
								strokeStyle: this.outlineColor,
								strokeWidth: this.outlineWidth,
								...val.outline,
								closed: true
							});
						}
						this.canvas.drawText({
							layer: true,
							name: 'sn'+si,
							groups: ['t', 's'+si],
							fillStyle: this.outlineColor,
							x: val.outline.x1 + 20, y: val.outline.y1 -20,
							fontSize: this.fontSize,
							fontFamily: this.fontFamily,
							text: val.name,
							fromCenter: false
						});
						
						val.features.forEach(function(val, fi, fa){
							switch(val.type){
								case "door": 
									this.canvas.drawLine({
										layer: true,
										name: 'd'+si+'.'+fi,
										groups: ['f','d', 's'+si],
										strokeStyle: this.doorColor,
										strokeWidth: this.outlineWidth+2,
										x1: val.x1,
										y1: val.y1,
										x2: val.x2,
										y2: val.y2,
									});
									if(val.isWC){
										this.canvas.drawText({
											layer: true,
											name: 'dw'+fi,
											groups: ['d', 's'+si],
											fillStyle: this.outlineColor,
											x: val.x1 + 20, y: val.y1 -20,
											fontSize: this.fontSize,
											fontFamily: this.fontFamily,
											text: "WC",
											fromCenter: false
										});
									}
									break;
								case "window":
									this.canvas.drawLine({
										layer: true,
										name: 'w'+si+'.'+fi,
										groups: ['f','w', 's'+si],
										strokeStyle: this.windowColor,
										strokeWidth: this.outlineWidth+2,
										x1: val.x1,
										y1: val.y1,
										x2: val.x2,
										y2: val.y2,
									});
									break;
							}
						}, this);
						
						val.tables.forEach(function(val, ti, ta){
							let tableWidth = (val.seatsX>0) ? this.tableBasis * val.seatsX : this.tableBasis;
							let tableHeight = (val.seatsY>0) ? this.tableBasis * val.seatsY : this.tableBasis;
							//table base
							this.canvas.drawRect({
								layer: true,
								name: 't'+si+'.'+ti,
								groups: ['t', 't'+si+'.'+ti, 's'+si],
								fillStyle: this.tableColor,
								x: val.x,
								y: val.y,
								width: tableWidth,
								height: tableHeight,
								fromCenter: false,
								data: {si: si, ti: ti}
							});
							//accessibility icon
							if(val.isAccessible){
								this.canvas.drawImage({
									layer: true,
									name: 'i'+si+'.'+ti,
									groups: ['i', 't'+si+'.'+ti, 's'+si],
									source: 'img/style/common/wheelchair_accessible_icon_wob.svg',
									x: val.x + 0.5*tableWidth,
									y: val.y + 0.5*tableHeight,
									width: this.tableBasis-2,
									height: this.tableBasis-2
								});
							}
							//seats
							if(val.seatsX){
								for(var i=0; i<val.seatsX; i++){
									//top
									this.canvas.drawRect({
										layer: true,
										name: 'c'+si+'.'+ti+'.t'+i,
										groups: ['c', 't'+si+'.'+ti, 's'+si],
										fillStyle: this.seatColor,
										x: val.x + i*this.tableBasis + 0.15*this.tableBasis,
										y: val.y - 0.25*this.tableBasis,
										width: this.tableBasis - 0.3*this.tableBasis,
										height: 0.25*this.tableBasis,
										fromCenter: false
									});
									//bottom
									this.canvas.drawRect({
										layer: true,
										name: 'c'+si+'.'+ti+'.b'+i,
										groups: ['c', 't'+si+'.'+ti, 's'+si],
										fillStyle: this.seatColor,
										x: val.x + i*this.tableBasis + 0.15*this.tableBasis,
										y: val.y + tableHeight,
										width: this.tableBasis - 0.3*this.tableBasis,
										height: 0.25*this.tableBasis,
										fromCenter: false
									});
								}
							}
							
							if(val.seatsY){
								for(var i=0; i<val.seatsY; i++){
									//left
									this.canvas.drawRect({
										layer: true,
										name: 'c'+si+'.'+ti+'.l'+i,
										groups: ['c', 't'+si+'.'+ti, 's'+si],
										fillStyle: this.seatColor,
										x: val.x - 0.25*this.tableBasis,
										y: val.y + i*this.tableBasis + 0.15*this.tableBasis,
										width: 0.25*this.tableBasis,
										height: this.tableBasis - 0.3*this.tableBasis,
										fromCenter: false,
										data: {si: si, ti: ti},
										mouseover: this.tableMouseover.bind(this),
										mouseout: this.tableMouseout.bind(this)
									});
									//right
									this.canvas.drawRect({
										layer: true,
										name: 'c'+si+'.'+ti+'.r'+i,
										groups: ['c', 't'+si+'.'+ti, 's'+si],
										fillStyle: this.seatColor,
										x: val.x + tableWidth,
										y: val.y + i*this.tableBasis + 0.15*this.tableBasis,
										width: 0.25*this.tableBasis,
										height: this.tableBasis - 0.3*this.tableBasis,
										fromCenter: false,
										data: {si: si, ti: ti},
										mouseover: this.tableMouseover.bind(this),
										mouseout: this.tableMouseout.bind(this)
									});
								}
							}
							//drawMouseTarget
							this.canvas.drawRect({
								layer: true,
								name: 'm'+si+'.'+ti,
								groups: ['m', 't'+si+'.'+ti, 's'+si],
								fillStyle: 'rgba(0,0,0,0)',
								x: (val.seatsY>0)?val.x - 0.25*this.tableBasis:val.x,
								y: (val.seatsX>0)?val.y - 0.25*this.tableBasis:val.y,
								width: (val.seatsY>0)?tableWidth + 0.5*this.tableBasis:tableWidth,
								height: (val.seatsX>0)?tableHeight + 0.5*this.tableBasis:tableHeight,
								fromCenter: false,
								data: {si: si, ti: ti},
								mouseover: this.tableMouseover.bind(this),
								mouseout: this.tableMouseout.bind(this),
								click: this.tableClick.bind(this)
							});
						}, this);
					}, this);
					
				}
				
				tableMouseover(layer){
					if(this.interactive){
						let layers = this.canvas.getLayerGroup('t'+layer.data.si+'.'+layer.data.ti);
						let base = layers.filter(function(val, i, a){return val.name[0] === 't'});
						let chairs = layers.filter(function(val, i, a){return val.name[0] === 'c'});
						
						this.canvas.animateLayer(base[0], {fillStyle: this.tableColorHover}, 250);
						chairs.forEach(function(val, i, a){this.canvas.animateLayer(val, {fillStyle: this.seatColorHover},250)}, this);
						this.canvas.css("cursor", "pointer");
					}
				}
				
				tableMouseout(layer){
					if(this.interactive){
						let layers = this.canvas.getLayerGroup('t'+layer.data.si+'.'+layer.data.ti);
						let base = layers.filter(function(val, i, a){return val.name[0] === 't'});
						let chairs = layers.filter(function(val, i, a){return val.name[0] === 'c'});
						
						this.canvas.animateLayer(base[0], {fillStyle: this.tableColor}, 250);
						chairs.forEach(function(val, i, a){this.canvas.animateLayer(val, {fillStyle: this.seatColor},250)}, this);
						this.canvas.css("cursor", "initial");
					}
				}
				
				tableClick(layer){
					if(this.interactive){
						if(this.clickCallback){
							this.clickCallback(layer.data.si, layer.data.ti);
						}
					}
				}
				
				setClickCallback(f){
					this.clickCallback = f;
				}
				
				
			};
			$(document).ready(function(){
				let r = new roomplan($("#roomplan"), roomdata);
			});
			</script>
		<!-- /ADDITIONAL SCRIPTS GO BETWEEN -->
	</head>
	<body>
		<div id="wrapper">
			<div id="main">
				<div id="header">
				<h1>Saladhouse</h1>
					<nav>
						<a href="index.html">Home</a>
						<a href="menu.html">Men&uuml;</a>
						<a href="roomplan.html"><h2>Roomplan</h2></a>
						<a href="contact.html">Kontakt</a>
					</nav>
				</div>
				<div id="content">
					<!--EDIT CONTENT-->
					<div class="image_container">
						<canvas id="roomplan" width="200" height="200"></canvas>
					</div>
					<!--/EDIT CONTENT-->
				</div>
				<div id="footer">
					<p><a href="impressum.html">Impressum</a>|<a href="agb.html">AGB</a>|<a href="#header">&#9650; Seiten Anfag</a></p>
				</div>
			</div>
		</div>
	</body>
</html>
